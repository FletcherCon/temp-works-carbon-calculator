<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temporary Works Carbon Calculator</title>
    <meta name="description" content="Calculate embodied carbon emissions for temporary works in construction based on Groundforce Shorco methodology">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: system-ui, -apple-system, sans-serif; }
    </style>
</head>
<body class="bg-gradient-to-br from-green-50 to-blue-50 min-h-screen">
    <div id="app" class="p-6 max-w-6xl mx-auto">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <div class="flex items-center gap-3 mb-6">
                <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                </svg>
                <h1 class="text-3xl font-bold text-gray-800">Temporary Works Carbon Calculator</h1>
            </div>
            
            <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6">
                <p class="text-sm text-gray-700">
                    Calculate embodied carbon for temporary works based on the Groundforce Shorco methodology. 
                    This includes manufacturing emissions (A1-A3) and transport emissions (A4).
                </p>
            </div>

            <!-- Input Form -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-6">
                <input type="text" id="description" placeholder="Description (e.g., Trench Box)" class="border rounded px-3 py-2">
                <select id="equipmentType" class="border rounded px-3 py-2">
                    <option value="steel">Steel</option>
                    <option value="aluminum">Aluminum</option>
                </select>
                <input type="number" id="weight" placeholder="Weight (kg)" class="border rounded px-3 py-2" min="0" step="0.01">
                <input type="number" id="hireWeeks" placeholder="Hire duration (weeks)" class="border rounded px-3 py-2" min="0" step="0.1">
                <input type="number" id="distance" placeholder="Distance (km)" class="border rounded px-3 py-2" min="0" step="0.1">
            </div>
            
            <button onclick="addItem()" class="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                </svg>
                Add Item
            </button>
        </div>

        <!-- Items Table -->
        <div id="itemsSection" class="bg-white rounded-lg shadow-lg p-6 mb-6 hidden">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-800">Equipment Items</h2>
                <button onclick="exportToCSV()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 flex items-center gap-2 text-sm">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    Export CSV
                </button>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Description</th>
                            <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Type</th>
                            <th class="px-4 py-3 text-right text-sm font-semibold text-gray-700">Weight (kg)</th>
                            <th class="px-4 py-3 text-right text-sm font-semibold text-gray-700">Weeks</th>
                            <th class="px-4 py-3 text-right text-sm font-semibold text-gray-700">Distance (km)</th>
                            <th class="px-4 py-3 text-right text-sm font-semibold text-gray-700">Embodied CO2e</th>
                            <th class="px-4 py-3 text-right text-sm font-semibold text-gray-700">Transport CO2e</th>
                            <th class="px-4 py-3 text-right text-sm font-semibold text-gray-700">Total CO2e</th>
                            <th class="px-4 py-3"></th>
                        </tr>
                    </thead>
                    <tbody id="itemsTable"></tbody>
                </table>
            </div>
        </div>

        <!-- Totals -->
        <div id="totalsSection" class="bg-white rounded-lg shadow-lg p-6 mb-6 hidden">
            <h2 class="text-xl font-bold text-gray-800 mb-4">Project Totals</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-green-50 p-4 rounded">
                    <p class="text-sm text-gray-600 mb-1">Embodied Carbon (A1-A3)</p>
                    <p class="text-2xl font-bold text-green-700"><span id="totalEmbodied">0.00</span> kg CO2e</p>
                    <p class="text-xs text-gray-500 mt-1"><span id="totalEmbodiedTonnes">0.000</span> tonnes CO2e</p>
                </div>
                <div class="bg-blue-50 p-4 rounded">
                    <p class="text-sm text-gray-600 mb-1">Transport Carbon (A4)</p>
                    <p class="text-2xl font-bold text-blue-700"><span id="totalTransport">0.00</span> kg CO2e</p>
                    <p class="text-xs text-gray-500 mt-1"><span id="totalTransportTonnes">0.000</span> tonnes CO2e</p>
                </div>
                <div class="bg-purple-50 p-4 rounded">
                    <p class="text-sm text-gray-600 mb-1">Total Carbon</p>
                    <p class="text-2xl font-bold text-purple-700"><span id="totalCarbon">0.00</span> kg CO2e</p>
                    <p class="text-xs text-gray-500 mt-1"><span id="totalCarbonTonnes">0.000</span> tonnes CO2e</p>
                </div>
            </div>
        </div>

        <!-- Info Section -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-3">Methodology Notes</h3>
            <ul class="text-sm text-gray-700 space-y-2">
                <li>• <strong>Embodied Carbon Rates:</strong> Steel: 2.5 kg CO2e/tonne/week, Aluminum: 8.5 kg CO2e/tonne/week (example values)</li>
                <li>• <strong>Transport Emissions:</strong> 0.062 kg CO2e/tonne/km (round trip included)</li>
                <li>• <strong>Lifecycle Stages:</strong> A1-A3 (Manufacturing) + A4 (Transport)</li>
                <li>• <strong>Note:</strong> These are example rates. Refer to <a href="https://www.vpgroundforce.com/gb/footer-links/useful-links/carbon-calculator-technical-note/" target="_blank" class="text-blue-600 hover:underline">Groundforce Shorco's technical guide</a> for accurate, equipment-specific rates.</li>
            </ul>
        </div>

        <!-- Footer -->
        <footer class="text-center mt-8 text-sm text-gray-600">
            <p>Based on Groundforce Shorco methodology | <a href="https://github.com/fletchercon/temp-works-carbon-calculator" target="_blank" class="text-blue-600 hover:underline">View on GitHub</a></p>
        </footer>
    </div>

    <script>
        // Data storage
        let items = [];
        
        // CO2e rates (kg CO2e per tonne per week) - UPDATE THESE WITH ACTUAL VALUES
        const co2Rates = {
            steel: 2.5,
            aluminum: 8.5
        };
        
        // Transport emissions (kg CO2e per tonne per km) - UPDATE WITH ACTUAL VALUE
        const transportRate = 0.062;

        function calculateItemCarbon(item) {
            const weightTonnes = parseFloat(item.weight) / 1000;
            const weeks = parseFloat(item.hireWeeks);
            const distance = parseFloat(item.distance) || 0;
            
            const embodiedCarbon = weightTonnes * co2Rates[item.equipmentType] * weeks;
            const transportCarbon = weightTonnes * distance * 2 * transportRate;
            
            return {
                embodied: embodiedCarbon,
                transport: transportCarbon,
                total: embodiedCarbon + transportCarbon
            };
        }

        function addItem() {
            const description = document.getElementById('description').value;
            const equipmentType = document.getElementById('equipmentType').value;
            const weight = document.getElementById('weight').value;
            const hireWeeks = document.getElementById('hireWeeks').value;
            const distance = document.getElementById('distance').value;

            if (description && weight && hireWeeks) {
                items.push({
                    id: Date.now(),
                    description,
                    equipmentType,
                    weight,
                    hireWeeks,
                    distance: distance || 0
                });

                // Clear inputs
                document.getElementById('description').value = '';
                document.getElementById('weight').value = '';
                document.getElementById('hireWeeks').value = '';
                document.getElementById('distance').value = '';

                renderItems();
            } else {
                alert('Please fill in at least Description, Weight, and Hire Duration');
            }
        }

        function removeItem(id) {
            if (confirm('Are you sure you want to remove this item?')) {
                items = items.filter(item => item.id !== id);
                renderItems();
            }
        }

        function renderItems() {
            const tbody = document.getElementById('itemsTable');
            tbody.innerHTML = '';

            let totals = { embodied: 0, transport: 0, total: 0 };

            items.forEach(item => {
                const carbon = calculateItemCarbon(item);
                totals.embodied += carbon.embodied;
                totals.transport += carbon.transport;
                totals.total += carbon.total;

                const row = document.createElement('tr');
                row.className = 'border-t hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-4 py-3 text-sm">${item.description}</td>
                    <td class="px-4 py-3 text-sm capitalize">${item.equipmentType}</td>
                    <td class="px-4 py-3 text-sm text-right">${parseFloat(item.weight).toFixed(2)}</td>
                    <td class="px-4 py-3 text-sm text-right">${parseFloat(item.hireWeeks).toFixed(1)}</td>
                    <td class="px-4 py-3 text-sm text-right">${item.distance ? parseFloat(item.distance).toFixed(1) : '-'}</td>
                    <td class="px-4 py-3 text-sm text-right">${carbon.embodied.toFixed(2)} kg</td>
                    <td class="px-4 py-3 text-sm text-right">${carbon.transport.toFixed(2)} kg</td>
                    <td class="px-4 py-3 text-sm text-right font-semibold">${carbon.total.toFixed(2)} kg</td>
                    <td class="px-4 py-3">
                        <button onclick="removeItem(${item.id})" class="text-red-600 hover:text-red-800" title="Delete item">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            // Update totals
            document.getElementById('totalEmbodied').textContent = totals.embodied.toFixed(2);
            document.getElementById('totalEmbodiedTonnes').textContent = (totals.embodied / 1000).toFixed(3);
            document.getElementById('totalTransport').textContent = totals.transport.toFixed(2);
            document.getElementById('totalTransportTonnes').textContent = (totals.transport / 1000).toFixed(3);
            document.getElementById('totalCarbon').textContent = totals.total.toFixed(2);
            document.getElementById('totalCarbonTonnes').textContent = (totals.total / 1000).toFixed(3);

            // Show/hide sections
            const hasItems = items.length > 0;
            document.getElementById('itemsSection').classList.toggle('hidden', !hasItems);
            document.getElementById('totalsSection').classList.toggle('hidden', !hasItems);
        }

        function exportToCSV() {
            const headers = ['Description', 'Equipment Type', 'Weight (kg)', 'Hire Duration (weeks)', 'Distance (km)', 'Embodied CO2e (kg)', 'Transport CO2e (kg)', 'Total CO2e (kg)'];
            
            const rows = items.map(item => {
                const carbon = calculateItemCarbon(item);
                return [
                    `"${item.description}"`,
                    item.equipmentType,
                    item.weight,
                    item.hireWeeks,
                    item.distance || 0,
                    carbon.embodied.toFixed(2),
                    carbon.transport.toFixed(2),
                    carbon.total.toFixed(2)
                ];
            });

            let totals = { embodied: 0, transport: 0, total: 0 };
            items.forEach(item => {
                const carbon = calculateItemCarbon(item);
                totals.embodied += carbon.embodied;
                totals.transport += carbon.transport;
                totals.total += carbon.total;
            });

            const csvContent = [
                headers.join(','),
                ...rows.map(row => row.join(',')),
                '',
                'Total Embodied CO2e (kg),' + totals.embodied.toFixed(2),
                'Total Transport CO2e (kg),' + totals.transport.toFixed(2),
                'Total CO2e (kg),' + totals.total.toFixed(2),
                '',
                'Generated by Temporary Works Carbon Calculator',
                'Date: ' + new Date().toLocaleDateString()
            ].join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'temporary-works-carbon-' + new Date().toISOString().slice(0,10) + '.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // Allow Enter key to add items
        document.addEventListener('DOMContentLoaded', function() {
            ['description', 'weight', 'hireWeeks', 'distance'].forEach(id => {
                document.getElementById(id).addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') addItem();
                });
            });
        });
    </script>
</body>
</html>
